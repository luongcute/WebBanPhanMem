@* @model WebBanPhanMem.Areas.Admin.Models.LicenseKeyAdminViewModel (Không cần Model nếu chỉ dùng ViewBag/Controller logic) *@
@{
    ViewData["Title"] = "Thêm License Key";
    // Lấy giá trị keysText đã gửi nếu có lỗi
    var previousKeysText = ViewData["keysText"] as string;
}

<div class="container mt-4">
    <h4 class="text-primary mb-4">
        <i class="bi bi-plus-circle"></i> Thêm License Key cho sản phẩm: **@ViewBag.ProductName**
    </h4>

    <form asp-action="Create" method="post" class="shadow-sm p-4 bg-white rounded">
        @* Input ẩn để truyền ProductId về Controller *@
        <input type="hidden" name="productId" value="@ViewBag.ProductId" />

        @* Hiển thị lỗi tổng quát (ví dụ: Lỗi key trống từ Controller) *@
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <div class="mb-3">
            <label for="keysText" class="form-label fw-bold">Danh sách key (mỗi dòng một key):</label>

            <textarea id="keysText" name="keysText" class="form-control" rows="8" placeholder="Nhập từng key trên mỗi dòng...">
                @* SỬA ĐỔI QUAN TRỌNG: Gán lại nội dung cũ nếu có *@
                @previousKeysText
            </textarea>
        </div>

        <div class="d-flex justify-content-end pt-2">
            <a asp-action="Index" asp-route-productId="@ViewBag.ProductId" class="btn btn-secondary me-2">
                <i class="bi bi-arrow-left"></i> Quay lại
            </a>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-save"></i> Lưu @((ViewBag.ProductName as string)?.Length > 0 ? " (" + ViewBag.ProductName + ")" : "")
            </button>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}